## Setup

### Local
- Clone repo & switch to node lts version using node version manager
- install yarn if absent ```npm install --global yarn```
- run ```yarn install``` in base directory to download all dependencies
- run ```yarn run dev``` to start local servers, local CORS proxy

### Docker
- run ```docker compose watch``` from base directory. It will build image, start dev server, local CORS proxy.  
It watches for file changes, it will reload dev server on code changes.
It will rebuild image for package.json changes
- To shutdown dev server, run ```shutdown.sh``` for executing ```docker compose down``` and ```docker image prune -f```.
Image prune is useful as dangling images might be created due to package.json changes

### Local Services
Following servers are brought up with ```yarn run dev```

|                                       |                                                   |
| ------------------------------------- | ------------------------------------------------- |
| Dev Server                            | http://localhost:4200/                            |
| Dev Server with mock data             | http://localhost:4201/                            | 
| Local CORS Proxy URL                  | http://localhost:3040/get?url=                    |

### Running Tests
Start dev server with ```yarn run dev``` before running tests. cors proxy started by this command is needed for karma test. Local dev server by doc tests
Then ```yarn test``` can be used to run test, ```yarn run coverage``` for coverage check and ```yarn run doc-test``` for running e2e doc test.

For docker, above commands can be run on container from docker desktop, exec tab of dust-dev-server-1 container.
Or you can go to container's shell from any other terminal, using docker exec.  
Run ```export CI=false``` before running tests to generate html report.
After running test inside docker, reports & docs can be extracted by ```get-docker-test-op.sh```.

### Known Issues
- 504 (Outdated Optimize Dep) : Stop dev server, Run ```yarn run clean```, clear browser cache, restart dev server & browser
- Flaky doc test : Doc test are automation tests, implemented using playwright. They fail randomly some times. As of now the reason is unclear,
and only solution is to re-run them

## Technical Details

### Tech Stack
- Angular Material for UI
- Tailwind for styling instead of angular scss. Angular scss is still used when overriding styles is needed
- Luxon lib for handling dates
- immutable js for lists, maps
- docsify for documentation website
- Playwright for e2e doc tests

### Code guidelines
- All components must be standalone
- Avoid writing logic in html as much as possible. Write function in component and call it
- All components must be built in reactive style, And have Change detection as OnPush
- All state objects must be immutable
- Every code change must be covered in unit tests, doc tests along with doc changes

### Test guidelines
- Specs should only focus on code and not html
- Only specs, focusing on integration should use TestBed. Fixtures should not be used
- All specs except integration should use mocks at boundaries, integration test should focus on testing contract

### Documentation guidelines
- For changing user guide, changes have to be made in playwright test (src/test/doc-tests/user-guide.pw.ts)
- Other md files can be directly updated in public folder
- Updated md file for user-guide will be generated by running playwright test
- Every doc section of user guide is associated with an e2e test to ensure its validity
- When implementing changes to application, relevant doc section and e2e change has to be implemented as well

## PR Guidelines
- After changes, code should still have 100% coverage in all categories (line, branch, functions, statements)
- If changes are made to doc tests, relevant doc section also need to be updated.